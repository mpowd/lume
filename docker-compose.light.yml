version: "3.8"

services:
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
    volumes:
      - ./data/qdrant:/qdrant/storage
    networks:
      - app_network

  api:
    build:
      context: .
      dockerfile: docker/api.light.Dockerfile
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app/backend
    depends_on:
      - qdrant
      - mongodb
    env_file:
      - .env
    environment:
      - DEPLOYMENT_MODE=light
      - USE_GPU=false
      - ENABLE_PHOENIX=false
      - ENABLE_OLLAMA=false
      - PYTHONPATH=/app
    networks:
      - app_network
    extra_hosts:
      - "host.docker.internal:host-gateway"

  mongodb:
    image: mongo:latest
    ports:
      - "27017:27017"
    volumes:
      - ./data/mongodb:/data/db
    networks:
      - app_network

networks:
  app_network:
    driver: bridge
